(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1e54dcd8"],{"24d2":function(e,t,r){"use strict";r.d(t,"o",(function(){return s})),r.d(t,"a",(function(){return a})),r.d(t,"d",(function(){return o})),r.d(t,"f",(function(){return i})),r.d(t,"c",(function(){return c})),r.d(t,"r",(function(){return l})),r.d(t,"m",(function(){return u})),r.d(t,"b",(function(){return f})),r.d(t,"s",(function(){return d})),r.d(t,"e",(function(){return m})),r.d(t,"k",(function(){return g})),r.d(t,"n",(function(){return p})),r.d(t,"j",(function(){return h})),r.d(t,"i",(function(){return v})),r.d(t,"l",(function(){return b})),r.d(t,"p",(function(){return j})),r.d(t,"q",(function(){return C})),r.d(t,"h",(function(){return y})),r.d(t,"g",(function(){return w}));var n=r("b775");function s(e,t){return Object(n["a"])({url:"/project/queryForProjects",method:"post",params:e,data:t})}function a(e){return Object(n["a"])({url:"/project/addProject",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/project/deleteProject/"+e,method:"delete"})}function i(e){return Object(n["a"])({url:"/project/updateProject",method:"post",data:e})}function c(e){return Object(n["a"])({url:"/project/checkProject/"+e,method:"get"})}function l(e,t){return Object(n["a"])({url:"/view/queryViews",method:"post",params:t,data:e})}function u(e){return Object(n["a"])({url:"/view/queryById/"+e,method:"get"})}function f(e){return Object(n["a"])({url:"/view/addViewRE",method:"post",data:e})}function d(e){return Object(n["a"])({url:"/view/updateView",method:"post",data:e})}function m(e){return Object(n["a"])({url:"/view/deleteView/"+e,method:"delete"})}function g(){return Object(n["a"])({url:"/view/getViewFilter",method:"post"})}function p(e){return Object(n["a"])({url:"/user/queryByNameSubUsers",method:"post",params:e})}function h(e){return Object(n["a"])({url:"/project/queryById/"+e,method:"get"})}function v(e){return Object(n["a"])({url:"/project/getCloseProject",method:"get",params:e})}function b(e){return Object(n["a"])({url:"/view/getViewScopeChildParams",method:"get",params:e})}function j(e){return Object(n["a"])({url:"/view/queryViewParents",method:"get",params:e})}function C(e){return Object(n["a"])({url:"/view/queryViewTrees",method:"get",params:e})}function y(){return Object(n["a"])({url:"/project/getAllSysCustomField",method:"get"})}function w(e){return Object(n["a"])({url:"/project/getAllCustomField",method:"post",data:e})}},"33c8":function(e,t,r){"use strict";r("fb6d")},"4f8c":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"signoff-container"},[r("el-card",[r("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.from,rules:e.rules,"label-width":"100px","label-position":"left"}},[r("div",[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.createLoading,expression:"createLoading"}],staticClass:"set_btn_type set_btn_2",on:{click:e.createFile}},[e._v(" "+e._s(e.$t("lang.SignOff.Generate"))+" ")])]),r("el-form-item",{staticClass:"form-small",attrs:{label:"项目",prop:"scope"}},[r("el-select",{attrs:{size:"small",disabled:""},on:{change:e.getProjectInfo},model:{value:e.projectId,callback:function(t){e.projectId=t},expression:"projectId"}},e._l(e.projectList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.title,value:e.id}})})),1)],1),r("el-form-item",{staticClass:"form-small",attrs:{label:"发布版本",prop:"version"}},[r("el-row",{staticClass:"radiu"},[r("el-radio-group",{on:{change:e.versionTypeChange},model:{value:e.baseInfo.version,callback:function(t){e.$set(e.baseInfo,"version",t)},expression:"baseInfo.version"}},[r("el-radio",{attrs:{label:!0}},[e._v("最新版本("+e._s(e.lastVersion)+")")]),r("el-radio",{attrs:{label:!1}},[r("el-select",{attrs:{size:"mini",placeholder:"测试版本",disabled:!0===e.baseInfo.version},on:{change:e.versionChange},model:{value:e.from.version,callback:function(t){e.$set(e.from,"version",t)},expression:"from.version"}},e._l(e.projectVersionList.mergeValues,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1)],1)],1),r("el-form-item",{staticClass:"form-small",attrs:{label:"测试环境",prop:"env"}},[r("el-select",{attrs:{size:"mini",placeholder:"1.0"},on:{change:e.envChange},model:{value:e.from.env,callback:function(t){e.$set(e.from,"env",t)},expression:"from.env"}},e._l(e.projectEnvList.mergeValues,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{staticClass:"form-small",attrs:{label:"测试周期",prop:"testCycle"}},[r("el-row",{staticClass:"radiu"},[r("el-radio-group",{on:{change:e.cycleTypeChange},model:{value:e.baseInfo.testCycle,callback:function(t){e.$set(e.baseInfo,"testCycle",t)},expression:"baseInfo.testCycle"}},[r("el-radio",{attrs:{label:"curentReleaseVersion"}},[e._v("当前版本")]),r("el-radio",{attrs:{label:!1}},[r("el-select",{attrs:{size:"mini",placeholder:"测试周期标题",disabled:"curentReleaseVersion"===e.baseInfo.testCycle,multiple:""},model:{value:e.from.testCycle,callback:function(t){e.$set(e.from,"testCycle",t)},expression:"from.testCycle"}},e._l(e.testCycleVersionList,(function(e,t){return r("el-option",{key:t,attrs:{label:e.title,value:e.title,multiple:""}})})),1)],1)],1)],1)],1),r("el-form-item",{staticClass:"form-small",attrs:{label:"缺陷",prop:"issue"}},[r("el-row",[r("el-row",{attrs:{span:4}},[r("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")])],1),r("el-checkbox-group",{on:{change:e.issueChecked},model:{value:e.from.issue,callback:function(t){e.$set(e.from,"issue",t)},expression:"from.issue"}},e._l(e.issues,(function(e,t){return r("el-checkbox",{key:t,attrs:{label:e,value:e}})})),1)],1)],1),r("el-form-item",{staticClass:"form-small",attrs:{label:"签名",prop:"fileUrl"}},[e.signiList.length>0?r("el-row",{staticClass:"radiu"},[r("el-radio-group",{model:{value:e.from.fileUrl,callback:function(t){e.$set(e.from,"fileUrl",t)},expression:"from.fileUrl"}},e._l(e.signiList,(function(t,n){return r("div",{key:n,staticClass:"mb-2 signi",staticStyle:{height:"22px"}},[r("el-radio",{attrs:{label:t.file_path}},[e._v(e._s(t.uuid_file_name))]),r("i",{staticClass:"el-icon el-icon-error",on:{click:function(r){return e.removeSigniList(t)}}})],1)})),0)],1):e._e(),r("UploadSigenatrue",{on:{getImgUrl:e.getImgUrl}})],1)],1)],1),r("el-card",[r("div",{staticClass:"pdf-list"},[r("div",{staticClass:"pdf-title"},[e._v("签收记录")]),e.records.length<=0?r("el-empty",{attrs:{description:"暂无签收记录"}}):e._e(),e._l(e.records,(function(t,n){return r("div",{key:t.id,staticClass:"pdf-name"},[e._v(" "+e._s(n+1)+". "),r("el-button",{attrs:{type:"text"},on:{click:function(r){return e.lookPdf(t)}}},[e._v(e._s(t.fileName))])],1)}))],2)])],1)},s=[],a=r("1da1"),o=r("5530"),i=(r("a15b"),r("96cf"),r("2f62")),c=r("b775");function l(e){return Object(c["a"])({url:"/signOff/getProjectEnv",method:"get",params:e})}function u(e){return Object(c["a"])({url:"/signOff/getProjectVersion",method:"get",params:e})}function f(e){return Object(c["a"])({url:"/signOff/getTestCycleDetail",method:"get",params:e})}function d(e){return Object(c["a"])({url:"/signOff/generate",method:"post",data:e})}function m(e){return Object(c["a"])({url:"/signOff/upload",method:"post",data:e})}function g(){return Object(c["a"])({url:"/signOff/getUserAttachmentSign",method:"get"})}function p(){return Object(c["a"])({url:"/signOff/getIssue",method:"get"})}function h(){return Object(c["a"])({url:"/signOff/getPdf",method:"get"})}function v(e){return Object(c["a"])({url:"/signOff/delete",method:"get",params:e})}var b=r("24d2"),j=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{accept:".jpg,.jpeg,.png",action:e.url,"auto-upload":!1,headers:e.headers,"show-file-list":!1,"on-change":e.handleChange}},[r("el-button",{attrs:{type:"primary",size:"small"}},[e._v("上传签名")]),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 仅支持JPG和PNG格式，且不超过5MB，一次只能上传一个文件 ")])],1)},C=[],y={data:function(){return{url:"http://124.71.142.223:8082/api/signOff/upload"}},computed:{headers:function(){return{Authorization:"Bearer "+localStorage.getItem("token")}}},methods:{handleChange:function(e,t){var r=this;if(console.log(e),"image/png"!==e.raw.type&&"image/jpg"!==e.raw.type&&"image/jpeg"!==e.raw.type)this.$message.warning("仅支持JPG和PNG格式"),this.$refs.upload.clearFiles();else if(e.size>5242880)this.$message.warning("上传文件大小不能超过5MB"),this.$refs.upload.clearFiles();else{var n=new FormData;n.append("file",e.raw),m(n).then((function(e){"200"===e.code&&(r.$message.success("上传成功"),r.$emit("getImgUrl",e))}))}}}},w=y,k=r("2877"),x=Object(k["a"])(w,j,C,!1,null,null,null),V=x.exports;r("d3b7"),r("159b"),r("fb6a"),r("ac1f"),r("1276");function O(e){if(!e||e.length<=0)return"";var t=[],r="";return e.forEach((function(e,n){var s=e.split(/[^\d]+/).slice(1);for(var a in console.log(s),s){if(!t[a]||+s[a]>+t[a])return t=s,void(r=n);if(+s[a]!==+t[a])break}})),e[r]}var I={name:"Dashboard",components:{UploadSigenatrue:V},data:function(){var e=this;return{createLoading:!1,searchFrom:{verison:"",env:"",testCycle:""},baseInfo:{version:!0,env:!0,testCycle:"curentReleaseVersion"},lastVersion:"",currentCycle:"",projectList:[],from:{env:"",testCycle:[],version:"",fileUrl:"",issue:[]},rules:{version:[{required:!0,validator:function(t,r,n){r||!1!==e.baseInfo.version?n():n(new Error("请选择发布版本"))},message:"请选择发布版本",trigger:"blur"}],env:[{required:!0,message:"请选择测试环境",trigger:"blur"}],testCycle:[{required:!0,validator:function(t,r,n){(!r||r.length<=0)&&"curentReleaseVersion"!==e.baseInfo.testCycle?n(new Error("请选择测试周期")):n()},message:"请选择测试周期",trigger:"blur"}],fileUrl:[{required:!0,message:"请选择签名",trigger:"blur"}],issue:[{required:!0,message:"请选择缺陷",trigger:"blur"}]},issues:[],signiList:[],signi:"",isIndeterminate:!0,checkAll:!1,projectEnvList:[],projectVersionList:[],testCycleVersionList:[],projectId:"",records:[]}},computed:Object(o["a"])({},Object(i["b"])(["name",{lang:function(e){return e.header.lang}}])),mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)",target:document.querySelector(".app-main")}),e.projectId=localStorage.getItem("projectId"),t.prev=2,t.next=5,e.getProject();case 5:return t.next=7,e.getProjectVersion();case 7:return t.next=9,e.getProjectEnv();case 9:return t.next=11,e.getTestCycleVersion();case 11:return t.next=13,e.issueList();case 13:return t.next=15,e.getSign();case 15:return t.next=17,e.recordList();case 17:t.next=22;break;case 19:t.prev=19,t.t0=t["catch"](2),console.log(t.t0);case 22:r.close();case 23:case"end":return t.stop()}}),t,null,[[2,19]])})))()},methods:{lookPdf:function(e){this.$message.warning("敬请期待")},versionTypeChange:function(e){this.baseInfo.verison=e,!0===e?(this.searchFrom.verison=this.lastVersion,this.from.version=""):this.from.version=this.searchFrom.version=this.projectVersionList.mergeValues?this.projectVersionList.mergeValues[0]:"",this.getTestCycleVersion()},versionChange:function(e){this.searchFrom.verison=e,this.getTestCycleVersion()},envChange:function(e){this.searchFrom.env=e,this.from.env=e,this.getTestCycleVersion()},cycleTypeChange:function(e){"curentReleaseVersion"===e?(this.baseInfo.testCycle="curentReleaseVersion",this.searchFrom.testCycle="curentReleaseVersion"):(this.baseInfo.testCycle=!1,this.from.testCycle=this.searchFrom.testCycle=this.testCycleVersionList.mergeValues?this.testCycleVersionList.mergeValues[0]:""),this.getTestCycleVersion()},handleCheckAllChange:function(e){this.from.issue=e?this.issues:[],this.isIndeterminate=!1},issueChecked:function(e){var t=e.length;this.checkAll=t===this.issues.length,this.isIndeterminate=t>0&&t<this.issues.length},removeSigniList:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){var n,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.$loading({lock:!0,text:"正在删除",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),r.prev=1,r.next=4,v({fileId:e.id});case 4:s=r.sent,n.close(),"200"===s.code&&t.$message.success("删除成功"),r.next=13;break;case 9:r.prev=9,r.t0=r["catch"](1),console.log(r.t0),n.close();case 13:t.getSign();case 14:case"end":return r.stop()}}),r,null,[[1,9]])})))()},createFile:function(){var e=this;this.createLoading=!0,this.$refs.createForm.validate(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r){var n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=28;break}return t.prev=1,n={env:e.from.env,fileUrl:e.from.fileUrl,issue:e.from.issue.join(","),projectId:localStorage.getItem("projectId"),testCycle:"curentReleaseVersion"===e.baseInfo.testCycle?"curentReleaseVersion=1":e.from.testCycle.join(","),version:e.baseInfo.version?e.lastVersion:e.from.version},t.next=5,d(n);case 5:if(s=t.sent,"200"!==s.code){t.next=22;break}return e.$message.success("生成成功"),t.next=10,e.getProject();case 10:return t.next=12,e.getProjectVersion();case 12:return t.next=14,e.getProjectEnv();case 14:return t.next=16,e.getTestCycleVersion();case 16:return t.next=18,e.issueList();case 18:return t.next=20,e.getSign();case 20:return t.next=22,e.recordList();case 22:t.next=27;break;case 24:t.prev=24,t.t0=t["catch"](1),console.log(t.t0);case 27:console.log("success");case 28:case"end":return t.stop()}}),t,null,[[1,24]])})));return function(e){return t.apply(this,arguments)}}()),this.createLoading=!1},getImgUrl:function(e){e&&this.getSign()},getProjectEnv:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l({projectId:e.projectId});case 2:r=t.sent,e.projectEnvList=r.data,e.from.env=e.projectEnvList.mergeValues[0]||"",e.baseInfo.env=e.projectEnvList.mergeValues[0]||"",e.searchFrom.env=e.projectEnvList.mergeValues[0]||"";case 7:case"end":return t.stop()}}),t)})))()},getProjectVersion:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u({projectId:e.projectId});case 2:r=t.sent,e.projectVersionList=r.data,e.lastVersion=O(e.projectVersionList.mergeValues),e.baseInfo.version=!0,e.searchFrom.version=e.lastVersion;case 7:case"end":return t.stop()}}),t)})))()},getTestCycleVersion:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.from.testCycle=[],t.next=3,f({projectId:e.projectId,env:e.searchFrom.env,version:e.baseInfo.version?e.lastVersion:e.from.version});case 3:r=t.sent,e.testCycleVersionList=r.data||[];case 5:case"end":return t.stop()}}),t)})))()},getSign:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,g();case 2:r=t.sent,e.signiList=r.data,e.from.fileUrl=r.data[0]?r.data[0].file_path:"";case 5:case"end":return t.stop()}}),t)})))()},getProject:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["o"])({pageNum:1,pageSize:10},{});case 2:r=t.sent,e.projectList=r.data;case 4:case"end":return t.stop()}}),t)})))()},getProjectInfo:function(){this.getProjectEnv(),this.getProjectVersion(),this.getTestCycleVersion()},issueList:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.from.issue=[],t.prev=1,t.next=4,p();case 4:r=t.sent,"200"===r.code?e.issues=r.data.mergeValues||[]:e.issues=[],t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[1,8]])})))()},recordList:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.records=[],t.prev=1,t.next=4,h();case 4:r=t.sent,"200"===r.code?e.records=r.data:e.records=[],t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[1,8]])})))()}}},L=I,_=(r("33c8"),Object(k["a"])(L,n,s,!1,null,null,null));t["default"]=_.exports},a15b:function(e,t,r){"use strict";var n=r("23e7"),s=r("44ad"),a=r("fc6a"),o=r("a640"),i=[].join,c=s!=Object,l=o("join",",");n({target:"Array",proto:!0,forced:c||!l},{join:function(e){return i.call(a(this),void 0===e?",":e)}})},fb6d:function(e,t,r){}}]);